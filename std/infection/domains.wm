-- Stdlib-declared infection domains (MVP metadata parsing)
--
-- NOTE: These declarations are parsed by the compiler but not enforced yet.
-- They are the starting point for the "stdlib owns infection semantics" refactor.

-- ---------------------------------------------------------------------------
-- effect domain (Result-like short-circuit, row_set)
-- ---------------------------------------------------------------------------
domain effect {
  stateKind rowSet;
  merge singleton;
  mergeRow union;
  boundary mustBeCarrier;
  conflict none;
};

-- ---------------------------------------------------------------------------
-- taint domain (Tainted-like, row_set)
-- ---------------------------------------------------------------------------
domain taint {
  stateKind rowSet;
  merge singleton;
  mergeRow union;
  boundary mustBeCarrier;
  conflict none;
};

-- ---------------------------------------------------------------------------
-- mem domain (non-linear, row_bag via "unique tag keys")
-- ---------------------------------------------------------------------------
domain mem {
  stateKind rowBag;
  merge singleton;
  mergeRow bagUnion;
  default {
    target arg0;
    requiresNot [Closed];
  };
};

-- ---------------------------------------------------------------------------
-- hole domain (hazel mode by default)
-- ---------------------------------------------------------------------------
domain hole {
  stateKind rowSet;
  merge singleton;
  mergeRow union;
};

policy pure {
  rejectsAllDomains;
};

policy noLeakMem {
  domain mem;
  requireAtReturn [Closed];
};
